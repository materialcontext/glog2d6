{{!-- Inventory Tab --}}
<div class="tab" data-group="primary" data-tab="inventory">
    <div class="inventory-section">

        {{!-- Enhanced inventory header with encumbrance display --}}
        <div class="inventory-header">
            <div class="slots-info">
                Slots: {{system.inventory.slots.used}} / {{system.inventory.slots.max}}
                {{#if (gt system.inventory.encumbrance 0)}}
                <span class="encumbrance-warning">
                    (Encumbered: -{{system.inventory.encumbrance}}
                    {{#if (and (gt system.inventory.slotEncumbrance 0) (gt
                    system.inventory.equipmentEncumbrance 0))}}
                    = {{system.inventory.slotEncumbrance}} slots + {{system.inventory.equipmentEncumbrance}}
                    equipment
                    {{else if (gt system.inventory.slotEncumbrance 0)}}
                    from slot overflow
                    {{else if (gt system.inventory.equipmentEncumbrance 0)}}
                    from equipment
                    {{/if}})
                </span>
                {{/if}}
            </div>
            {{#if editMode}}
            <div class="item-controls">
                <a class="item-control item-create" data-type="weapon" title="Create Weapon">
                    <i class="fas fa-sword"></i> Weapon
                </a>
                <a class="item-control item-create" data-type="armor" title="Create Armor">
                    <i class="fas fa-shield-alt"></i> Armor
                </a>
                <a class="item-control item-create" data-type="shield" title="Create Shield">
                    <i class="fas fa-shield"></i> Shield
                </a>
                <a class="item-control item-create" data-type="gear" title="Create Gear">
                    <i class="fas fa-suitcase"></i> Gear
                </a>
                <a class="item-control item-create" data-type="torch" title="Create Torch">
                    <i class="fas fa-fire"></i> Torch
                </a>
            </div>
            {{/if}}
        </div>
    </div>
    <div class="items-list">
        {{#each actor.items as |item id|}}
        {{#unless (or (eq item.type "feature") (eq item.type "spell"))}}
        <div class="item flexrow" data-item-id="{{item.id}}">

            {{!-- Special handling for torch items --}}
            {{#if (eq item.type "torch")}}
            <div class="item-equipped">
                <div class="torch-icon {{#if (and ../system.torch.lit (eq ../system.torch.activeTorchId item.id))}}torch-active{{/if}}"
                    data-item-id="{{item.id}}" data-action="toggle-torch"
                    title="{{#if (and ../system.torch.lit (eq ../system.torch.activeTorchId item.id))}}Active Torch - Click to extinguish{{else}}Click to light this torch{{/if}}">
                    <i class="fas fa-fire"></i>
                </div>
            </div>
            {{else}}
            {{!-- Regular equipped checkbox for non-torch items --}}
            <div class="item-equipped">
                <input type="checkbox" class="equipped-toggle" data-item-id="{{item.id}}" {{#if
                    item.system.equipped}}checked{{/if}} title="Equipped" />
            </div>
            {{/if}}

            <div class="item-name">
                <div class="item-image">
                    <img src="{{item.img}}" title="{{item.name}}" width="24" height="24" />
                </div>
                <h4>{{item.name}}</h4>
            </div>

            <div class="item-details">
                {{#if (eq item.type "weapon")}}
                <span class="item-detail">{{item.system.damage}} dmg</span>
                <span class="item-detail">{{item.system.size}}</span>
                {{#if (gt item.system.encumbrancePenalty 0)}}
                <span class="item-detail equipment-penalty">-{{item.system.encumbrancePenalty}} enc</span>
                {{/if}}
                {{#if (and (not ../editMode) item.system.equipped)}}
                <button type="button" class="weapon-attack-btn" data-item-id="{{item.id}}"
                    title="Attack with {{item.name}}">
                    <i class="fas fa-sword"></i>
                </button>
                {{/if}}
                {{else if (eq item.type "armor")}}
                <span class="item-detail">+{{item.system.armorBonus}} AC</span>
                <span class="item-detail">{{item.system.type}}</span>
                {{#if (gt item.system.encumbrancePenalty 0)}}
                <span class="item-detail equipment-penalty">-{{item.system.encumbrancePenalty}} enc</span>
                {{/if}}
                {{else if (eq item.type "shield")}}
                <span class="item-detail">+{{item.system.armorBonus}} AC</span>
                <span class="item-detail">shield</span>
                {{else if (eq item.type "torch")}}
                <span class="item-detail">{{item.system.lightRadius.bright}}/{{item.system.lightRadius.dim}}ft</span>
                {{#if item.system.duration.enabled}}
                <span
                    class="item-detail torch-duration {{#if (lt item.system.duration.remaining 1)}}torch-duration-warning{{else if (lt item.system.duration.remaining 2)}}torch-duration-low{{/if}}">
                    {{item.system.duration.remaining}}h
                </span>
                {{else}}
                <span class="item-detail">âˆž</span>
                {{/if}}
                {{#if (and ../system.torch.lit (eq ../system.torch.activeTorchId item.id))}}
                <span class="item-detail torch-active-badge">ACTIVE</span>
                {{/if}}
                {{else if (eq item.type "gear")}}
                <span class="item-detail">{{item.system.size}}</span>
                <span class="item-detail">{{item.system.value}}gp</span>
                {{/if}}
            </div>

            <div class="item-slots">
                {{#unless (eq item.type "armor")}}
                {{item.system.slots}} slots
                {{/unless}}
            </div>

            {{#if ../editMode}}
            <div class="item-controls">
                <a class="item-control item-edit" title="Edit Item">
                    <i class="fas fa-edit"></i>
                </a>
                <a class="item-control item-delete" title="Delete Item">
                    <i class="fas fa-trash"></i>
                </a>
            </div>
            {{/if}}
        </div>
        {{/unless}}
        {{/each}}
    </div>
</div>
