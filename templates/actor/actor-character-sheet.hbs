<form class="{{cssClass}} {{actor.type}}" autocomplete="off">

  {{!-- Header --}}
  <header class="sheet-header">
    <div class="character-portrait">
      <img src="{{actor.img}}" alt="{{actor.name}}" data-edit="img" title="Character Portrait"/>
    </div>

    <div class="name-bar">
      {{#if editMode}}
      <input name="name" type="text" value="{{actor.name}}" placeholder="Character Name" class="name-input"/>
      {{else}}
      <div class="name-display">{{actor.name}}</div>
      {{/if}}
    </div>

    <div class="info-grid">
      <!-- Blank space: grid-column 1/5, grid-row 1 -->

      <div class="class-section">
        <label class="label-med">Class</label>
        {{#if editMode}}
        <input name="system.details.class" type="text" value="{{system.details.class}}" placeholder="Class" class="class-input input-base"/>
        {{else}}
        <div class="class-display">{{system.details.class}}</div>
        {{/if}}
      </div>

      <div class="level-section">
        {{#if editMode}}
        <label class="label-med">XP</label>
        <input name="system.details.xp" type="number" value="{{system.details.xp}}" min="0" class="level-input input-base"/>
        {{else}}
        <label class="label-med">Level</label>
        <div class="level-display">{{system.details.level}}</div>
        {{/if}}
      </div>

      <!-- Blank space: grid-column 4, grid-row 2 -->

      <div class="hp-section">
        <div class="hp-container">
          <input name="system.hp.value" type="number" value="{{system.hp.value}}" min="0" class="hp-current"/>
          <span class="hp-separator">/</span>
          {{#if editMode}}
          <input name="system.hp.max" type="number" value="{{system.hp.max}}" min="1" class="hp-max-input"/>
          {{else}}
          <span class="hp-max">{{system.hp.max}}</span>
          {{/if}}
        </div>
        <div class="hp-label">HP</div>
      </div>

      <div class="max-section">
        <div class="max-container">
          <span class="hp-max">{{system.hp.max}}</span>
        </div>
        <div class="max-label">MAX</div>
      </div>

      <div class="wounds-section">
        <label class="label-small">Wounds</label>
        <input name="system.wounds" type="number" value="{{system.wounds}}" min="0" class="wounds-input input-base"/>
      </div>

      <div class="trauma-section">
        <button type="button" class="trauma-btn btn-base theme-btn" data-action="trauma">Trauma</button>
      </div>

      <div class="torch-move-section">
        <div class="torch-toggle">
          <label class="label-small">Torch</label>
          <input type="checkbox" name="system.torch" {{#if system.torch}}checked{{/if}} class="torch-checkbox"/>
        </div>
        <div class="move-controls">
          <label class="label-small">Move</label>
          {{#if editMode}}
          <input name="system.details.movement" type="number" value="{{system.details.movement}}" min="0" class="movement-input input-base"/>
          {{else}}
          <div class="movement-display clickable theme-btn" data-action="movement">
            {{#if system.details.effectiveMovement}}
              {{system.details.effectiveMovement}}
              {{#if (gt system.inventory.encumbrance 0)}}
              <span class="encumbrance-penalty">({{system.details.movement}})</span>
              {{/if}}
            {{else}}
              {{system.details.movement}}
            {{/if}}
          </div>
          {{/if}}
        </div>
      </div>
    </div>

    <button type="button" class="edit-toggle btn-base" title="{{#if editMode}}Exit Edit Mode{{else}}Edit Mode{{/if}}">
      <i class="fas {{#if editMode}}fa-lock{{else}}fa-edit{{/if}}"></i>
    </button>
  </header>

  {{!-- Main Content --}}
  <section class="sheet-body">

    {{!-- Attributes Section --}}
    <div class="attributes-section">
      <h3>Attributes</h3>
      <div class="attributes-grid">
        {{#each system.attributes as |attr key|}}
        <div class="attribute-card {{#unless ../editMode}}clickable{{/unless}}" {{#unless ../editMode}}data-attribute="{{key}}"{{/unless}}>
          <div class="attribute-main">
            <div class="attribute-name">{{upperCase key}}</div>
            {{#if ../editMode}}
            <input name="system.attributes.{{key}}.value" type="number" value="{{attr.value}}" min="2" max="12" class="attribute-input"/>
            {{else}}
            <div class="attribute-value">{{attr.value}}</div>
            {{/if}}
            <div class="attribute-mod">({{numberFormat attr.mod decimals=0 sign=true}})</div>
          </div>
          <div class="attribute-save" data-attribute="{{key}}">
            <span class="save-label">SAVE</span>
          </div>
        </div>
        {{/each}}
      </div>
    </div>

    {{!-- Combat Section --}}
    <div class="combat-section">
      <h3>Combat</h3>
      <div class="combat-actions">
        <div class="combat-card {{#unless editMode}}clickable{{/unless}}" data-action="attack">
          <div class="combat-main">
            <div class="combat-name">Attack</div>
            {{#if editMode}}
            <input name="system.combat.attack.value" type="number" value="{{system.combat.attack.value}}" class="combat-input"/>
            {{else}}
            <div class="combat-value">{{system.combat.attack.value}}</div>
            {{/if}}
          </div>
        </div>

        <div class="combat-card {{#unless editMode}}clickable{{/unless}}" data-action="defend">
          <div class="combat-main">
            <div class="combat-name">Defend</div>
            <div class="combat-value">{{system.defense.total}}</div>
          </div>
        </div>
      </div>
    </div>

    {{!-- Inventory Section --}}
    <div class="inventory-section">
      <h3>Inventory</h3>
      <div class="inventory-header">
        <div class="slots-info">
          Slots: {{system.inventory.slots.used}} / {{system.inventory.slots.max}}
          {{#if system.inventory.encumbrance}}
          <span class="encumbrance-warning">(Encumbered: {{system.inventory.encumbrance}})</span>
          {{/if}}
        </div>
        {{#if editMode}}
        <div class="item-controls">
          <a class="item-control item-create" data-type="weapon" title="Create Weapon">
            <i class="fas fa-sword"></i> Weapon
          </a>
          <a class="item-control item-create" data-type="armor" title="Create Armor">
            <i class="fas fa-shield-alt"></i> Armor
          </a>
          <a class="item-control item-create" data-type="shield" title="Create Shield">
            <i class="fas fa-shield"></i> Shield
          </a>
          <a class="item-control item-create" data-type="gear" title="Create Gear">
            <i class="fas fa-suitcase"></i> Gear
          </a>
        </div>
        {{/if}}
      </div>

      <div class="items-list">
        {{#each actor.items as |item id|}}
        <div class="item flexrow" data-item-id="{{item.id}}">
          <div class="item-equipped">
            <input type="checkbox" class="equipped-toggle" data-item-id="{{item.id}}" {{#if item.system.equipped}}checked{{/if}} title="Equipped"/>
          </div>

          <div class="item-name">
            <div class="item-image">
              <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
            </div>
            <h4>{{item.name}}</h4>
          </div>

          <div class="item-details">
            {{#if (eq item.type "weapon")}}
              <span class="item-detail">{{item.system.damage}} dmg</span>
              <span class="item-detail">{{item.system.size}}</span>
              {{#if (and (not ../editMode) item.system.equipped)}}
              <button type="button" class="weapon-attack-btn" data-item-id="{{item.id}}" title="Attack with {{item.name}}">
                <i class="fas fa-sword"></i>
              </button>
              {{/if}}
            {{else if (eq item.type "armor")}}
              <span class="item-detail">+{{item.system.armorBonus}} AC</span>
              <span class="item-detail">{{item.system.type}}</span>
            {{else if (eq item.type "shield")}}
              <span class="item-detail">+{{item.system.armorBonus}} AC</span>
              <span class="item-detail">shield</span>
            {{else if (eq item.type "gear")}}
              <span class="item-detail">{{item.system.size}}</span>
              <span class="item-detail">{{item.system.value}}gp</span>
            {{/if}}
          </div>

          <div class="item-slots">
            {{#unless (eq item.type "armor")}}
            {{item.system.slots}} slots
            {{/unless}}
          </div>

          {{#if ../editMode}}
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item">
              <i class="fas fa-edit"></i>
            </a>
            <a class="item-control item-delete" title="Delete Item">
              <i class="fas fa-trash"></i>
            </a>
          </div>
          {{/if}}
        </div>
        {{/each}}
      </div>
    </div>

  </section>
</form>
